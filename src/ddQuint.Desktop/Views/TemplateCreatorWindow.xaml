<Window x:Class="ddQuint.Desktop.Views.TemplateCreatorWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Template Creator"
        Height="605" Width="1000"
        MinHeight="300" MinWidth="400"
        Background="{StaticResource WindowBackgroundBrush}"
        WindowStartupLocation="CenterOwner"
        Loaded="Window_Loaded">
    <Grid Background="{StaticResource SidebarBackgroundBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Row 1: Dropdowns (grid to align Experiment right edge) -->
        <Grid Grid.Row="0" Margin="10,10,10,2" VerticalAlignment="Center">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="240"/>
                <ColumnDefinition Width="12"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="200"/>
                <ColumnDefinition Width="12"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <TextBlock Grid.Column="0" Text="Supermix:" Foreground="{StaticResource TextBrush}" Margin="0,0,6,0" VerticalAlignment="Center"/>
            <ComboBox Grid.Column="1" x:Name="SupermixCombo" Height="20" SelectionChanged="OnSelectionChanged" Style="{StaticResource DarkParameterComboBox}"/>
            <TextBlock Grid.Column="3" Text="Assay:" Foreground="{StaticResource TextBrush}" Margin="0,0,6,0" VerticalAlignment="Center"/>
            <ComboBox Grid.Column="4" x:Name="AssayCombo" Height="20" SelectionChanged="OnAssayChanged" Style="{StaticResource DarkParameterComboBox}"/>
            <TextBlock Grid.Column="6" Text="Experiment:" Foreground="{StaticResource TextBrush}" Margin="0,0,6,0" VerticalAlignment="Center"/>
            <ComboBox Grid.Column="7" x:Name="ExperimentCombo" Height="20" SelectionChanged="OnSelectionChanged" Style="{StaticResource DarkParameterComboBox}" Margin="0,0,3,0"/>
        </Grid>

        <!-- Row 2: Targets + Hint + Help + Export Button -->
        <Grid Grid.Row="1" Margin="10,5,10,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                <TextBlock Text="Targets:" Foreground="{StaticResource TextBrush}" Margin="0,0,8,0" VerticalAlignment="Center"/>
                <TextBlock x:Name="TargetHintLabel" Foreground="{StaticResource SecondaryTextBrush}" Margin="0,0,12,0" VerticalAlignment="Center"/>
                <TextBox x:Name="Target1" Width="150" Margin="0,0,6,0" TextChanged="OnTargetChanged" Style="{StaticResource DarkParameterTextBox}"/>
                <TextBox x:Name="Target2" Width="150" Margin="0,0,6,0" TextChanged="OnTargetChanged" Style="{StaticResource DarkParameterTextBox}"/>
                <TextBox x:Name="Target3" Width="150" Margin="0,0,6,0" TextChanged="OnTargetChanged" Style="{StaticResource DarkParameterTextBox}"/>
                <TextBox x:Name="Target4" Width="150" Margin="0,0,6,0" TextChanged="OnTargetChanged" Style="{StaticResource DarkParameterTextBox}"/>
            </StackPanel>

            <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">
                <Button x:Name="HelpButton" Width="20" Height="20" Margin="0,0,8,0" Style="{StaticResource CircularIconButton}"
                        Click="HelpButton_Click"
                        ToolTipService.IsEnabled="False">
                    <TextBlock Text="?" FontSize="12"/>
                </Button>
                <Button x:Name="ExportButton" Content="Export Template..." MinWidth="170" Style="{StaticResource MacOSButton}" Click="ExportButton_Click" IsEnabled="False"/>
            </StackPanel>
            
            <!-- Help popup styled like our ToolTips -->
            <Popup x:Name="HelpPopup" PlacementTarget="{Binding ElementName=HelpButton}" Placement="Bottom" StaysOpen="True" AllowsTransparency="True" PopupAnimation="Fade">
                <Border Background="{StaticResource ToolTipBackgroundBrush}"
                        BorderBrush="{StaticResource BorderBrush}"
                        BorderThickness="1"
                        CornerRadius="6"
                        Padding="10">
                    <StackPanel>
                        <TextBlock Text="Template Creator" FontWeight="Bold" Foreground="{StaticResource TextBrush}" Margin="0,0,0,6"/>
                        <TextBlock TextWrapping="Wrap" Width="340" Foreground="{StaticResource TextBrush}">
                            Use a CSV or XLSX without a header row. Each row is a sample with up to 4 description fields. Columns 1–3 are shown per well; the 4th is included only in the export. Samples are placed column‑major (A1..H1, then A2..H2, etc.).
                        </TextBlock>
                    </StackPanel>
                </Border>
            </Popup>
        </Grid>

        <!-- Row 3: Preview Container (drop/click prompt OR grid preview) -->
        <Grid Grid.Row="2" Background="#252524" Margin="10" x:Name="PreviewContainer">
            <!-- Drop/Click Prompt styled like main window -->
            <Border x:Name="DropPrompt"
                    Background="#B21E1E1E" Margin="10"
                    AllowDrop="True"
                    MouseLeftButtonUp="DropPrompt_MouseLeftButtonUp"
                    Drop="DropPrompt_Drop"
                    DragOver="DropPrompt_DragOver">
                <Grid>
                    <Rectangle Stroke="#FF323232" StrokeThickness="2" Margin="10" Fill="Transparent">
                        <Rectangle.StrokeDashArray>
                            <DoubleCollection>3 2.4</DoubleCollection>
                        </Rectangle.StrokeDashArray>
                    </Rectangle>
                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                        <TextBlock Text="Click to select file with sample names" 
                                   FontSize="18" FontWeight="SemiBold"
                                   Foreground="White"
                                   HorizontalAlignment="Center" Margin="0,0,0,8"/>
                        <TextBlock Text="CSV/XLSX without header; up to 4 columns" 
                                   FontSize="14" FontWeight="SemiBold"
                                   Foreground="#DDFFFFFF"
                                   HorizontalAlignment="Center"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Grid Preview -->
            <ScrollViewer x:Name="PlateScroll" Visibility="Collapsed" VerticalScrollBarVisibility="Auto">
                <ScrollViewer.Resources>
                    <Style x:Key="{x:Type ScrollBar}" TargetType="{x:Type ScrollBar}">
                        <Setter Property="Width" Value="8"/>
                        <Setter Property="Background" Value="#2B2B2B"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="{x:Type ScrollBar}">
                                    <Grid>
                                        <Border Background="{TemplateBinding Background}" CornerRadius="4"/>
                                        <Track Name="PART_Track" IsDirectionReversed="true">
                                            <Track.Thumb>
                                                <Thumb>
                                                    <Thumb.Template>
                                                        <ControlTemplate TargetType="{x:Type Thumb}">
                                                            <Border Background="#555555" CornerRadius="4" Margin="1"/>
                                                        </ControlTemplate>
                                                    </Thumb.Template>
                                                </Thumb>
                                            </Track.Thumb>
                                        </Track>
                                    </Grid>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </ScrollViewer.Resources>
                <Grid x:Name="PlateGrid" HorizontalAlignment="Center" VerticalAlignment="Center"/>
            </ScrollViewer>
        </Grid>
    </Grid>
</Window>
